<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Info TrÃ¤nare</title>
    <style>
        body{font-family:Arial;max-width:500px;margin:20px auto;padding:20px;background:#f5f5f5}
        .container{background:white;padding:25px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);margin-bottom:20px}
        input{width:100%;padding:12px;margin:8px 0;border:1px solid #ddd;border-radius:5px;box-sizing:border-box;font-size:14px}
        button{background:#4CAF50;color:white;padding:12px 24px;border:none;border-radius:5px;margin:5px;cursor:pointer;font-size:14px}
        button:hover{background:#45a049}
        .audio-btn{background:#2196F3;padding:8px 16px;font-size:12px;margin:0 3px}
        .audio-btn:hover{background:#1976D2}
        .page{display:none}.page.active{display:block}
        h3{color:#333;text-align:center;margin-bottom:20px}
        .question{font-size:18px;margin:15px 0;padding:15px;background:#f0f8ff;border-radius:5px;text-align:center}
        .feedback{margin:10px 0;padding:10px;border-radius:5px;font-weight:bold;text-align:center}
        .correct{background:#d4edda;color:#155724}
        .incorrect{background:#f8d7da;color:#72121f}
        .answer-box{background:#fff3cd;padding:15px;margin:10px 0;border-radius:5px;display:none}
        .saved-info{background:#e8f5e8;padding:15px;border-radius:5px;margin-top:15px}
        .info-item{background:white;padding:10px;margin:5px 0;border-radius:3px;border-left:4px solid #4CAF50;display:flex;justify-content:space-between;align-items:center}
        label{font-weight:bold;color:#555;margin-top:10px;display:block}
        .audio-controls{display:flex;gap:5px;align-items:center}
        .tts-status{font-size:11px;color:#666;margin-top:5px}
        .voice-selector{background:#f0f8ff;padding:10px;border-radius:5px;margin-bottom:10px}
        select{width:100%;padding:8px;border-radius:5px;border:1px solid #ddd}
    </style>
</head>
<body>
    <div id="info" class="container page active">
        <h3>ğŸ“ Mina Uppgifter</h3>
        
        <div class="voice-selector">
            <label>VÃ¤lj svensk rÃ¶st:</label>
            <select id="voiceSelect">
                <option value="">Laddar rÃ¶ster...</option>
            </select>
        </div>
        
        <label>Adress:</label>
        <input id="adr" value="GrÃ¤nsholmsbacken 2" placeholder="Din adress">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playOptimizedTTS('Din adress Ã¤r GrÃ¤nsholmsbacken 2')">ğŸ”Š</button>
            <button class="audio-btn" onclick="playOptimizedTTS('Din adress Ã¤r GrÃ¤nsholmsbacken 2', true)">ğŸŒ</button>
        </div>
        
        <label>Telefon/mobil nummer:</label>
        <input id="tel" value="070 418 56 49" placeholder="Ditt telefonnummer">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playOptimizedTTS('Ditt telefonnummer Ã¤r 070 418 56 49')">ğŸ”Š</button>
            <button class="audio-btn" onclick="playOptimizedTTS('Ditt telefonnummer Ã¤r 070 418 56 49', true)">ğŸŒ</button>
        </div>
        
        <label>Personnummer:</label>
        <input id="pers" value="19971231-8907" placeholder="Ditt personnummer">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playOptimizedPersonnummer('19971231-8907')">ğŸ”Š</button>
            <button class="audio-btn" onclick="playOptimizedPersonnummer('19971231-8907', true)">ğŸŒ</button>
        </div>
        
        <label>Hawa personnummer:</label>
        <input id="b1" value="20250102-2582" placeholder="Hawa personnummer">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playOptimizedPersonnummer('20250102-2582')">ğŸ”Š</button>
            <button class="audio-btn" onclick="playOptimizedPersonnummer('20250102-2582', true)">ğŸŒ</button>
        </div>
        
        <label>Leyla personnummer:</label>
        <input id="b2" value="20250102-0388" placeholder="Leyla personnummer">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playOptimizedPersonnummer('20250102-0388')">ğŸ”Š</button>
            <button class="audio-btn" onclick="playOptimizedPersonnummer('20250102-0388', true)">ğŸŒ</button>
        </div>
        
        <div class="saved-info">
            <h4>âœ… Sparad Information:</h4>
            <div class="info-item">
                <div><strong>Adress:</strong> GrÃ¤nsholmsbacken 2</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playOptimizedTTS('GrÃ¤nsholmsbacken 2')">ğŸ”Š</button>
                    <button class="audio-btn" onclick="playOptimizedTTS('GrÃ¤nsholmsbacken 2', true)">ğŸŒ</button>
                </div>
            </div>
            <div class="info-item">
                <div><strong>Telefon:</strong> 070 418 56 49</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playOptimizedTTS('070 418 56 49')">ğŸ”Š</button>
                    <button class="audio-btn" onclick="playOptimizedTTS('070 418 56 49', true)">ğŸŒ</button>
                </div>
            </div>
            <div class="info-item">
                <div><strong>Personnummer:</strong> 19971231-8907</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playOptimizedPersonnummer('19971231-8907')">ğŸ”Š</button>
                    <button class="audio-btn" onclick="playOptimizedPersonnummer('19971231-8907', true)">ğŸŒ</button>
                </div>
            </div>
            <div class="info-item">
                <div><strong>Hawa:</strong> 20250102-2582</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playOptimizedPersonnummer('20250102-2582')">ğŸ”Š</button>
                    <button class="audio-btn" onclick="playOptimizedPersonnummer('20250102-2582', true)">ğŸŒ</button>
                </div>
            </div>
            <div class="info-item">
                <div><strong>Leyla:</strong> 20250102-0388</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playOptimizedPersonnummer('20250102-0388')">ğŸ”Š</button>
                    <button class="audio-btn" onclick="playOptimizedPersonnummer('20250102-0388', true)">ğŸŒ</button>
                </div>
            </div>
        </div>
        
        <div class="tts-status">Optimerat fÃ¶r svenskt tal</div>
        
        <div style="text-align:center;margin-top:20px">
            <button onclick="save()">ğŸ’¾ Spara</button>
            <button onclick="train()">ğŸ¯ TrÃ¤na</button>
        </div>
    </div>

    <div id="train" class="container page">
        <h3>ğŸ“ TrÃ¤na pÃ¥ din information</h3>
        
        <div style="text-align:center;margin:15px 0">
            <button class="audio-btn" onclick="playOptimizedCurrentQuestion()">ğŸ”Š Spela frÃ¥ga</button>
            <button class="audio-btn" onclick="playOptimizedCurrentQuestion(true)">ğŸ”ŠğŸŒ LÃ¥ngsamt</button>
        </div>
        
        <div id="qdiv" class="question"></div>
        
        <label>Ditt svar:</label>
        <input id="ans" placeholder="Skriv ditt svar hÃ¤r..." onkeypress="if(event.key==='Enter')check()">
        
        <div style="text-align:center;margin-top:20px">
            <button onclick="check()">âœ… Kontrollera</button>
            <button onclick="nextQ()">ğŸ”„ Ny frÃ¥ga</button>
            <button onclick="back()">ğŸ“‹ Tillbaka</button>
        </div>
        
        <div id="fb" class="feedback"></div>
        
        <div id="sol" class="answer-box">
            <div style="text-align:center;margin-bottom:10px">
                <button class="audio-btn" onclick="playOptimizedAnswer()">ğŸ”Š Spela svar</button>
                <button class="audio-btn" onclick="playOptimizedAnswer(true)">ğŸ”ŠğŸŒ LÃ¥ngsamt</button>
            </div>
            <div id="corr"></div>
        </div>
    </div>

    <script>
        let data = {}, q = [], cur = {};
        let voices = [];
        let selectedVoice = null;
        
        // FÃ¶rifylld data
        data = {
            adr: "GrÃ¤nsholmsbacken 2",
            tel: "070 418 56 49",
            pers: "19971231-8907",
            b1: "20250102-2582",
            b2: "20250102-0388"
        };

        // LADDA RÃ–STER OCH VÃ„LJ SVENSKA
        function loadVoices() {
            voices = speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '';
            
            // Hitta svenska rÃ¶ster
            const swedishVoices = voices.filter(voice => 
                voice.lang.includes('sv') || 
                voice.name.toLowerCase().includes('swedish') ||
                voice.name.toLowerCase().includes('svenska')
            );
            
            if (swedishVoices.length > 0) {
                swedishVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    if (index === 0) option.selected = true;
                    voiceSelect.appendChild(option);
                });
                selectedVoice = swedishVoices[0];
            } else {
                // AnvÃ¤nd fÃ¶rsta bÃ¤sta rÃ¶st om inga svenska finns
                if (voices.length > 0) {
                    selectedVoice = voices[0];
                    const option = document.createElement('option');
                    option.value = selectedVoice.name;
                    option.textContent = `${selectedVoice.name} (${selectedVoice.lang})`;
                    option.selected = true;
                    voiceSelect.appendChild(option);
                }
            }
        }

        document.getElementById('voiceSelect').addEventListener('change', function() {
            selectedVoice = voices.find(voice => voice.name === this.value);
        });

        // FÃ–RBÃ„TTRAT TAL-SYSTEM
        function playOptimizedTTS(text, slow = false) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                
                // AnvÃ¤nd Google TTS fÃ¶rst (funkar lokalt)
                const lang = 'sv';
                const speed = slow ? '0.7' : '1.0';
                const ttsUrl = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(text)}&tl=${lang}&ttsspeed=${speed}&client=tw-ob`;
                
                const audio = new Audio(ttsUrl);
                audio.play().catch(error => {
                    console.log('Google TTS misslyckades, anvÃ¤nder Web Speech API');
                    // Fallback till Web Speech API med optimerade instÃ¤llningar
                    const utterance = new SpeechSynthesisUtterance(text);
                    if (selectedVoice) {
                        utterance.voice = selectedVoice;
                    }
                    utterance.lang = 'sv-SE';
                    utterance.rate = slow ? 0.8 : 1.0;
                    utterance.pitch = 0.95;
                    utterance.volume = 1;
                    speechSynthesis.speak(utterance);
                });
            }
        }

        // OPTIMERAD PERSONNUMMER UTTAL
        function formatPersonnummerForTTS(personnummer) {
            const clean = personnummer.replace(/[\s-]/g, '');
            const year = clean.substring(0, 4);
            const month = clean.substring(4, 6);
            const day = clean.substring(6, 8);
            const lastFour = clean.substring(8, 12);
            
            // Separera de sista fyra siffrorna fÃ¶r korrekt uttal
            const lastFourSeparated = lastFour[0] + lastFour[1] + ' ' + lastFour[2] + lastFour[3];
            
            if (year.startsWith('20')) {
                return `${year} ${month}-${day} ${lastFourSeparated}`;
            } else {
                return `${year} ${month}-${day} ${lastFourSeparated}`;
            }
        }

        // OPTIMERADE PLAY FUNCTIONS
        function playOptimizedPersonnummer(personnummer, slow = false) {
            const formatted = formatPersonnummerForTTS(personnummer);
            playOptimizedTTS(formatted, slow);
        }

        function playOptimizedCurrentQuestion(slow = false) {
            let question = cur.q;
            if (question.includes('personnummer')) {
                const formattedNummer = formatPersonnummerForTTS(cur.a);
                question = question.replace('?', '') + ' ' + formattedNummer;
            }
            playOptimizedTTS(question, slow);
        }

        function playOptimizedAnswer(slow = false) {
            let answer = 'RÃ¤tt svar Ã¤r: ';
            if (cur.a.match(/\d{8}-\d{4}/)) {
                answer += formatPersonnummerForTTS(cur.a);
            } else {
                answer += cur.a;
            }
            playOptimizedTTS(answer, slow);
        }

        // FUNKTION FÃ–R ATT NORMALISERA SVAR
        function normalizeAnswer(answer) {
            return answer.replace(/[\s-]/g, '');
        }

        // Resten av funktionerna (save, train, check, etc.)
        function save() {
            data = {
                adr: document.getElementById('adr').value.trim(),
                tel: document.getElementById('tel').value.trim(),
                pers: document.getElementById('pers').value.trim(),
                b1: document.getElementById('b1').value.trim(),
                b2: document.getElementById('b2').value.trim()
            };
            
            localStorage.setItem('userData', JSON.stringify(data));
            alert('âœ… Information sparad!');
        }

        function train() {
            q = [
                {q: 'Vad Ã¤r din adress?', a: data.adr},
                {q: 'Vad Ã¤r ditt telefonnummer?', a: data.tel},
                {q: 'Vad Ã¤r ditt personnummer?', a: data.pers},
                {q: 'Vad Ã¤r Hawa personnummer?', a: data.b1},
                {q: 'Vad Ã¤r Leyla personnummer?', a: data.b2}
            ];
            
            document.getElementById('info').classList.remove('active');
            document.getElementById('train').classList.add('active');
            nextQ();
        }

        function nextQ() {
            if (q.length === 0) return;
            cur = q[Math.floor(Math.random() * q.length)];
            document.getElementById('qdiv').textContent = cur.q;
            document.getElementById('ans').value = '';
            document.getElementById('fb').innerHTML = '';
            document.getElementById('sol').style.display = 'none';
            document.getElementById('ans').focus();
        }

        function check() {
            const userAnswer = document.getElementById('ans').value.trim();
            const fb = document.getElementById('fb');
            const sol = document.getElementById('sol');
            const corr = document.getElementById('corr');
            
            if (!userAnswer) {
                fb.innerHTML = '<div class="feedback incorrect">Var vÃ¤nlig skriv ett svar!</div>';
                return;
            }
            
            const normalizedUserAnswer = normalizeAnswer(userAnswer);
            const normalizedCorrectAnswer = normalizeAnswer(cur.a);
            
            if (normalizedUserAnswer === normalizedCorrectAnswer) {
                fb.innerHTML = '<div class="feedback correct">âœ… RÃ¤tt svar!</div>';
                sol.style.display = 'none';
                setTimeout(nextQ, 2000);
            } else {
                fb.innerHTML = '<div class="feedback incorrect">âŒ Fel svar</div>';
                corr.textContent = 'RÃ¤tt svar: ' + cur.a;
                sol.style.display = 'block';
            }
        }

        function back() {
            document.getElementById('train').classList.remove('active');
            document.getElementById('info').classList.add('active');
        }

        // Initiera
        window.onload = function() {
            loadVoices();
            localStorage.setItem('userData', JSON.stringify(data));
            speechSynthesis.onvoiceschanged = loadVoices;
        };
    </script>
</body>
</html>
