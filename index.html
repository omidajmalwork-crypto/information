<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Info Tr√§nare</title>
    <style>
        body{font-family:Arial;max-width:500px;margin:20px auto;padding:20px;background:#f5f5f5}
        .container{background:white;padding:25px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);margin-bottom:20px}
        input{width:100%;padding:12px;margin:8px 0;border:1px solid #ddd;border-radius:5px;box-sizing:border-box;font-size:14px}
        button{background:#4CAF50;color:white;padding:12px 24px;border:none;border-radius:5px;margin:5px;cursor:pointer;font-size:14px}
        button:hover{background:#45a049}
        .audio-btn{background:#2196F3;padding:8px 16px;font-size:12px;margin:0 3px}
        .audio-btn:hover{background:#1976D2}
        .page{display:none}.page.active{display:block}
        h3{color:#333;text-align:center;margin-bottom:20px}
        .question{font-size:18px;margin:15px 0;padding:15px;background:#f0f8ff;border-radius:5px;text-align:center}
        .feedback{margin:10px 0;padding:10px;border-radius:5px;font-weight:bold;text-align:center}
        .correct{background:#d4edda;color:#155724}
        .incorrect{background:#f8d7da;color:#72121f}
        .answer-box{background:#fff3cd;padding:15px;margin:10px 0;border-radius:5px;display:none}
        .saved-info{background:#e8f5e8;padding:15px;border-radius:5px;margin-top:15px}
        .info-item{background:white;padding:10px;margin:5px 0;border-radius:3px;border-left:4px solid #4CAF50;display:flex;justify-content:space-between;align-items:center}
        label{font-weight:bold;color:#555;margin-top:10px;display:block}
        .audio-controls{display:flex;gap:5px;align-items:center}
        .tts-status{font-size:11px;color:#666;margin-top:5px}
    </style>
</head>
<body>
    <div id="info" class="container page active">
        <h3>üìç Mina Uppgifter</h3>
        
        <label>Adress:</label>
        <input id="adr" value="Gr√§nsholmsbacken 2" placeholder="Din adress">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playGoogleTTS('Din adress √§r Gr√§nsholmsbacken 2')">üîä</button>
            <button class="audio-btn" onclick="playGoogleTTS('Din adress √§r Gr√§nsholmsbacken 2', true)">üêå</button>
        </div>
        
        <label>Telefon/mobil nummer:</label>
        <input id="tel" value="070 418 56 49" placeholder="Ditt telefonnummer">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playGoogleTTS('Ditt telefonnummer √§r 070 418 56 49')">üîä</button>
            <button class="audio-btn" onclick="playGoogleTTS('Ditt telefonnummer √§r 070 418 56 49', true)">üêå</button>
        </div>
        
        <label>Personnummer:</label>
        <input id="pers" value="19971231-8907" placeholder="Ditt personnummer">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playPersonnummer('19971231-8907')">üîä</button>
            <button class="audio-btn" onclick="playPersonnummer('19971231-8907', true)">üêå</button>
        </div>
        
        <label>Hawa personnummer:</label>
        <input id="b1" value="20250102-2582" placeholder="Hawa personnummer">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playPersonnummer('20250102-2582')">üîä</button>
            <button class="audio-btn" onclick="playPersonnummer('20250102-2582', true)">üêå</button>
        </div>
        
        <label>Leyla personnummer:</label>
        <input id="b2" value="20250102-0388" placeholder="Leyla personnummer">
        <div class="audio-controls">
            <button class="audio-btn" onclick="playPersonnummer('20250102-0388')">üîä</button>
            <button class="audio-btn" onclick="playPersonnummer('20250102-0388', true)">üêå</button>
        </div>
        
        <div class="saved-info">
            <h4>‚úÖ Sparad Information:</h4>
            <div class="info-item">
                <div><strong>Adress:</strong> Gr√§nsholmsbacken 2</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playGoogleTTS('Gr√§nsholmsbacken 2')">üîä</button>
                    <button class="audio-btn" onclick="playGoogleTTS('Gr√§nsholmsbacken 2', true)">üêå</button>
                </div>
            </div>
            <div class="info-item">
                <div><strong>Telefon:</strong> 070 418 56 49</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playGoogleTTS('070 418 56 49')">üîä</button>
                    <button class="audio-btn" onclick="playGoogleTTS('070 418 56 49', true)">üêå</button>
                </div>
            </div>
            <div class="info-item">
                <div><strong>Personnummer:</strong> 19971231-8907</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playPersonnummer('19971231-8907')">üîä</button>
                    <button class="audio-btn" onclick="playPersonnummer('19971231-8907', true)">üêå</button>
                </div>
            </div>
            <div class="info-item">
                <div><strong>Hawa:</strong> 20250102-2582</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playPersonnummer('20250102-2582')">üîä</button>
                    <button class="audio-btn" onclick="playPersonnummer('20250102-2582', true)">üêå</button>
                </div>
            </div>
            <div class="info-item">
                <div><strong>Leyla:</strong> 20250102-0388</div>
                <div class="audio-controls">
                    <button class="audio-btn" onclick="playPersonnummer('20250102-0388')">üîä</button>
                    <button class="audio-btn" onclick="playPersonnummer('20250102-0388', true)">üêå</button>
                </div>
            </div>
        </div>
        
        <div class="tts-status">Anv√§nder Google Translate TTS f√∂r naturligt ljud</div>
        
        <div style="text-align:center;margin-top:20px">
            <button onclick="save()">üíæ Spara</button>
            <button onclick="train()">üéØ Tr√§na</button>
        </div>
    </div>

    <div id="train" class="container page">
        <h3>üéì Tr√§na p√• din information</h3>
        
        <div style="text-align:center;margin:15px 0">
            <button class="audio-btn" onclick="playCurrentQuestion()">üîä Spela fr√•ga</button>
            <button class="audio-btn" onclick="playCurrentQuestion(true)">üîäüêå L√•ngsamt</button>
        </div>
        
        <div id="qdiv" class="question"></div>
        
        <label>Ditt svar:</label>
        <input id="ans" placeholder="Skriv ditt svar h√§r..." onkeypress="if(event.key==='Enter')check()">
        
        <div style="text-align:center;margin-top:20px">
            <button onclick="check()">‚úÖ Kontrollera</button>
            <button onclick="nextQ()">üîÑ Ny fr√•ga</button>
            <button onclick="back()">üìã Tillbaka</button>
        </div>
        
        <div id="fb" class="feedback"></div>
        
        <div id="sol" class="answer-box">
            <div style="text-align:center;margin-bottom:10px">
                <button class="audio-btn" onclick="playAnswer()">üîä Spela svar</button>
                <button class="audio-btn" onclick="playAnswer(true)">üîäüêå L√•ngsamt</button>
            </div>
            <div id="corr"></div>
        </div>
    </div>

    <script>
        let data = {}, q = [], cur = {};
        
        // F√∂rifylld data
        data = {
            adr: "Gr√§nsholmsbacken 2",
            tel: "070 418 56 49",
            pers: "19971231-8907",
            b1: "20250102-2582",
            b2: "20250102-0388"
        };

        // FUNKTION F√ñR PERSONNUMMER UTTAL
        function formatPersonnummerForTTS(personnummer) {
            // Ta bort mellanslag och bindestreck
            const clean = personnummer.replace(/[\s-]/g, '');
            
            // Dela upp i grupper f√∂r naturligt svenskt uttal
            const year = clean.substring(0, 4);      // 1997 ‚Üí "nitton hundra nittiosju"
            const month = clean.substring(4, 6);     // 12 ‚Üí "tolv"
            const day = clean.substring(6, 8);       // 31 ‚Üí "trettioett"
            const lastFour = clean.substring(8, 12); // 8907 ‚Üí "√•ttionio nollsju"
            
            // Konvertera m√•nad och dag till namn f√∂r korrekt uttal
            const monthNames = ['noll-ett', 'noll-tv√•', 'noll-tre', 'noll-fyra', 'noll-fem', 'noll-sexa', 
                               'noll-sju', 'noll-√•tta', 'noll-nio', 'tio', 'elva', 'tolv'];
            const dayNames = ['noll-ett', 'noll-tv√•', 'noll-tre', 'noll-fyra', 'noll-fem', 'noll-sexa', 
                             'noll-sju', 'noll-√•tta', 'noll-nio', 'tio', 'elva', 'tolv', 'tretton', 'fjorton', 
                             'femton', 'sexton', 'sjutton', 'arton', 'nitton', 'tjugo', 'tjugoett', 'tjugotv√•', 
                             'tjugotre', 'tjugofyra', 'tjugofem', 'tjugosex', 'tjugosju', 'tjugo√•tta', 
                             'tjugonio', 'trettio', 'trettioett'];
            
            const monthName = monthNames[parseInt(month) - 1] || month;
            const dayName = dayNames[parseInt(day) - 1] || day;
            
            // Separera de sista fyra siffrorna f√∂r korrekt uttal
            const lastFourSeparated = lastFour[0] + lastFour[1] + ' ' + lastFour[2] + lastFour[3];
            
            // Formatera f√∂r naturligt svenskt uttal
            if (year.startsWith('20')) {
                // 2025 ‚Üí "tv√•tusentjugofem"
                return `${year} ${monthName} ${dayName} ${lastFourSeparated}`;
            } else {
                // 1997 ‚Üí "nitton hundra nittiosju"
                return `${year} ${monthName} ${dayName} ${lastFourSeparated}`;
            }
        }

        // GOOGLE TRANSLATE TTS
        function playGoogleTTS(text, slow = false) {
            // Rensa text fr√•n specialtecken
            const cleanText = text.replace(/[<>]/g, '');
            
            // Bygg Google Translate TTS URL
            const lang = 'sv';
            const speed = slow ? '0.7' : '1.0';
            const ttsUrl = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(cleanText)}&tl=${lang}&ttsspeed=${speed}&client=tw-ob`;
            
            // Skapa audio element
            const audio = new Audio(ttsUrl);
            audio.play().catch(error => {
                console.log('Google TTS misslyckades:', error);
                // Fallback till Web Speech API
                fallbackSpeech(cleanText, slow);
            });
        }

        // SPECIELL FUNKTION F√ñR PERSONNUMMER
        function playPersonnummer(personnummer, slow = false) {
            const formatted = formatPersonnummerForTTS(personnummer);
            playGoogleTTS(formatted, slow);
        }

        // FALLBACK TILL WEB SPEECH API
        function fallbackSpeech(text, slow = false) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'sv-SE';
                utterance.rate = slow ? 0.8 : 1.0;
                utterance.pitch = 0.95;
                speechSynthesis.speak(utterance);
            }
        }

        // FUNKTION F√ñR ATT NORMALISERA SVAR (ta bort streck, mellanslag etc.)
        function normalizeAnswer(answer) {
            return answer.replace(/[\s-]/g, '');
        }

        // Spara information
        function save() {
            data = {
                adr: document.getElementById('adr').value.trim(),
                tel: document.getElementById('tel').value.trim(),
                pers: document.getElementById('pers').value.trim(),
                b1: document.getElementById('b1').value.trim(),
                b2: document.getElementById('b2').value.trim()
            };
            
            localStorage.setItem('userData', JSON.stringify(data));
            alert('‚úÖ Information sparad!');
        }

        // Starta tr√§ning
        function train() {
            q = [
                {q: 'Vad √§r din adress?', a: data.adr},
                {q: 'Vad √§r ditt telefonnummer?', a: data.tel},
                {q: 'Vad √§r ditt personnummer?', a: data.pers},
                {q: 'Vad √§r Hawa personnummer?', a: data.b1},
                {q: 'Vad √§r Leyla personnummer?', a: data.b2}
            ];
            
            document.getElementById('info').classList.remove('active');
            document.getElementById('train').classList.add('active');
            nextQ();
        }

        // N√§sta fr√•ga
        function nextQ() {
            if (q.length === 0) return;
            cur = q[Math.floor(Math.random() * q.length)];
            document.getElementById('qdiv').textContent = cur.q;
            document.getElementById('ans').value = '';
            document.getElementById('fb').innerHTML = '';
            document.getElementById('sol').style.display = 'none';
            document.getElementById('ans').focus();
        }

        // Kontrollera svar med FLEXIBEL VALIDERING
        function check() {
            const userAnswer = document.getElementById('ans').value.trim();
            const fb = document.getElementById('fb');
            const sol = document.getElementById('sol');
            const corr = document.getElementById('corr');
            
            if (!userAnswer) {
                fb.innerHTML = '<div class="feedback incorrect">Var v√§nlig skriv ett svar!</div>';
                return;
            }
            
            // NORMALISERA B√ÖDA SVAREN (ta bort streck, mellanslag etc.)
            const normalizedUserAnswer = normalizeAnswer(userAnswer);
            const normalizedCorrectAnswer = normalizeAnswer(cur.a);
            
            if (normalizedUserAnswer === normalizedCorrectAnswer) {
                fb.innerHTML = '<div class="feedback correct">‚úÖ R√§tt svar!</div>';
                sol.style.display = 'none';
                setTimeout(nextQ, 2000);
            } else {
                fb.innerHTML = '<div class="feedback incorrect">‚ùå Fel svar</div>';
                corr.textContent = 'R√§tt svar: ' + cur.a;
                sol.style.display = 'block';
            }
        }

        // Tillbaka till info
        function back() {
            document.getElementById('train').classList.remove('active');
            document.getElementById('info').classList.add('active');
        }

        // PLAY FUNCTIONS MED KORREKT FORMATERING
        function playCurrentQuestion(slow = false) {
            let question = cur.q;
            
            // Om det g√§ller personnummer, formatera korrekt
            if (question.includes('personnummer')) {
                const formattedNummer = formatPersonnummerForTTS(cur.a);
                question = question.replace('?', '') + ' ' + formattedNummer;
            }
            
            playGoogleTTS(question, slow);
        }

        function playAnswer(slow = false) {
            let answer = 'R√§tt svar √§r: ';
            
            // Formatera beroende p√• typ
            if (cur.a.match(/\d{8}-\d{4}/)) {
                answer += formatPersonnummerForTTS(cur.a);
            } else {
                answer += cur.a;
            }
            
            playGoogleTTS(answer, slow);
        }

        // Initiera
        window.onload = function() {
            localStorage.setItem('userData', JSON.stringify(data));
        };
    </script>
</body>
</html>